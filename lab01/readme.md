# Лабораторная работа №1. Виртуальный сервер

## Студент

**Богданов Юрий, группа I2302**  
**Дата выполнения: 14.02.2025**  

## Описание задачи

В данной лабораторной работе предстоит изучить основы виртуализации операционных систем и практическую настройку виртуального HTTP-сервера. В ходе выполнения задания будет создана виртуальная машина с ОС Debian, работающая под управлением гипервизора QEMU. Также будет проведена установка и настройка программного стека LAMP, веб-интерфейса PhpMyAdmin и системы управления контентом Drupal. Кроме того, потребуется выполнить настройку виртуальных хостов в Apache и завершить развёртывание веб-сайтов.

## Ход выполнения работы

### Начало работы

1) Для начала необходимо скачать и установить MSYS2.

![image](https://i.imgur.com/rCdKS18.png)

2) Далее после установки необходимо открыть MSYS2 и создать папку `lab01` с помощью команды `mkdir lab01`

3) В папке `lab01` необходимо создать папку `dvd` и файл `readme.md` с помощью команды  `cat > readme.md`

- Нам необходимо зайти на оффициальный сайт `Debian` и скопировать ссылку на скачивание образа `64-bit PC DVD-1 iso`

![image](https://i.imgur.com/WD5s0rq.png)
![image](https://i.imgur.com/K51nSpr.png)

4) Далее необходимо зайти в папку `dvd` с помощью команды  `cd dvd` и в консоли выполнить следующую команду для скачивания файла (здесь параметр `-O` , который сохраняет скачанный образ как `debian.iso`):

```sh
wget -O debian.iso https://cdimage.debian.org/debian-cd/current/amd64/iso-dvd/debian-12.9.0-amd64-DVD-1.iso
```

5) Командой указанной на оффициальном сайте необходимо установить `QEMU`:

  ```sh
   pacman -S mingw-w64-ucrt-x86_64-qemu
   ```

- `QEMU` был успешно установлен.

## Установка Debian на виртуальную машину

- Чтобы создать образ диска на виртуальной машине необходимо выполнить следующиую команду:

![image](https://i.imgur.com/G0JuWzB.png)

- Запуск осущесвтляется с помощью команды:

![image](https://i.imgur.com/rS9YYZd.png)

- Устанока `Debian` произошла успешно с первого раза (была выбрана установка с графическим интерфейсом).

![image](https://i.imgur.com/nL7A7va.png)

- При установке `Debian` необходимо ввести следующие данные:
   - Имя компьютера: **debian**
   - Хостовое имя: **debian.localhost**
   - Имя пользователя: **user**
   - Пароль пользователя: **password**

- На этапе Software Selection было выбрано только standart system utilities (без графической оболочки и рабочего стола).

## Запуск виртуальной машины

После установки необходимо запустить виртуальную машину с диском `debian.qcow2`, выделив ей 2 ГБ оперативной памяти и 2 ядра процессора. Далее следует создать NAT-сеть и настроить перенаправление портов, чтобы обеспечить доступ к веб-серверу на виртуальной машине по адресу: `http://localhost:1080`.

```sh
qemu-system-x86_64 -hda debian.qcow2 -m 2G -smp 2 \
    -device e1000,netdev=net0 -netdev user,id=net0,hostfwd=tcp::1080-:80,hostfwd=tcp::1022-:22
```

![image](https://i.imgur.com/22W7c4v.png)

## Установка LAMP

1. Для начала переключаемся на суперпользователя с помощью команды `su`:

![image](https://i.imgur.com/Ga9R4uO.png)

2. При обновлении списка пакетов и установке программ с помощью команд возникли ошибки.

![image](https://i.imgur.com/cMLZh0m.png)

Причиной ошибки стало отсутствие ссылок на репозитории в файле по пути `/etc/apt/sources.list`. Чтобы устранить проблему, в данный файл были добавлены необходимые ссылки.

- Для начала редактирования файла была выполнена следующая команда:

 ```sh
   nano /etc/apt/sources.list
   ```

- Туда добавляется следующее:

![image](https://i.imgur.com/f2oK88t.png)

- После необходимо ввести следующие команды:

 ```sh
   apt update -y
   ```

```sh
   apt install -y apache2 php libapache2-mod-php php-mysql mariadb-server mariadb-client unzip
   ```

**Описание установленных пакетов:**  

- **`apache2`** — веб-сервер Apache, который обеспечивает обработку HTTP-запросов.  
- **`php`** — интерпретатор для выполнения скриптов на языке PHP.  
- **`libapache2-mod-php`** — модуль, интегрирующий интерпретатор PHP с веб-сервером Apache.  
- **`php-mysql`** — расширение PHP для работы с базами данных MySQL/MariaDB.  
- **`mariadb-server`** — сервер баз данных MariaDB (форк MySQL), используемый для хранения данных.  
- **`mariadb-client`** — клиент для подключения и взаимодействия с сервером MariaDB.  
- **`unzip`** — утилита для извлечения файлов из ZIP-архивов.  

## Установка PhpMyAdmin и CMS Drupal

- Необходимо скачать с помощью следующих команд PhpMyAdmin и CMS Drupal:

![image](https://i.imgur.com/4pkwyBV.jpeg)

![image](https://i.imgur.com/qpE7gXe.jpeg)

- Проверка наличия файлов:

![image](https://i.imgur.com/8S6okQw.png)

- Распаковка и перемещение файлов:
 - Вводим следующие команды:
```sh
   unzip phpMyAdmin-5.2.2-all-languages.zip
   ```

```sh
   unzip drupal-10.0.5.zip
   ```

![image](https://i.imgur.com/MKUUVYW.png)

 ```sh
   mkdir /var/www
unzip phpMyAdmin-5.2.2-all-languages.zip
mv phpMyAdmin-5.2.2-all-languages /var/www/phpmyadmin
unzip drupal-10.0.5.zip
mv drupal-10.0.5 /var/www/drupal
   ```

## Настройка Базы данных

- Через командную строку была создана база данных drupal_db для CMS  и пользователь базы данных с именем `user`.

```sh
   mysql -u root
CREATE DATABASE drupal_db;
CREATE USER 'user'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON drupal_db.* TO 'user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
   ```

### Настройка виртуальных хостов Apache

Небходимо создать файлы конфигурации `nano /etc/apache2/sites-available/01-phpmyadmin.conf`

![image](https://i.imgur.com/YFkGqcy.jpeg)

- По такому же принципу выполняется для `drupal`:

`nano /etc/apache2/sites-available/02-drupal.conf`

![image](https://i.imgur.com/F6l2Olb.jpeg)

- Были заригистрированы конфигурации:

```sh
   /usr/sbin/a2ensite 01-phpmyadmin
   /usr/sbin/a2ensite 02-drupal
   ```

 - Перезапускаем Apache HTTP Server:

```sh
systemctl reload apache2
```

- После этого добавляются записи в `/etc/hosts` :

![image](https://i.imgur.com/KyU22Aq.jpeg)

## Запуск и тестирование

![image](https://i.imgur.com/53NlGaK.png)

- Проверка версии системы с помощью команды `uname -a`.

- Перезагрузка Apache:

```sh
   systemctl restart apache2
   ```

- Далее в браузере проверяем доступность сайтов `http://drupal.localhost:1080` и `http://phpmyadmin.localhost:1080`; Завершаем их настройку.

![image](https://i.imgur.com/5kKw2Bz.png)
![image](https://i.imgur.com/S4yDO6d.png)

Видим, что сайты доступны. Можно завершать их настройку.

![image](https://i.imgur.com/XzvKMx3.png)
![image](https://i.imgur.com/EUWAojO.png)

- Чтобы исправить данные ошибки необходимо ввести следующие команды:

![image](https://i.imgur.com/LobsSys.png)
![image](https://i.imgur.com/oFutrFZ.png)

Видим, что ошибки исправлены успешно:
![image](https://i.imgur.com/Hq6cyOe.png)

- Продолжаем настройку:
![image](https://i.imgur.com/x4MIkCD.png)
![image](https://i.imgur.com/VwYwzy0.png)
![image](https://i.imgur.com/2ni2WIp.png)

## Успешный результат

![image](https://i.imgur.com/weHyCrw.png)

## Ответы на вопросы

1. **Как скачать файл в консоли при помощи утилиты `wget`?**  
   Используется команда:  
   ```bash
   wget https://example.com/file.zip
   ```

2. **Зачем необходимо создавать для каждого сайта свою базу и своего пользователя?**  
   - Для безопасности: один сайт не сможет получить доступ к базе данных другого.  
   - Для управления правами: можно настроить доступ только к нужным данным.  
   - Для удобства резервного копирования и обслуживания.  

3. **Как поменять доступ к системе управления БД на порт 1234?**  
   В конфигурационном файле базы данных (например, `/etc/mysql/mysql.conf.d/mysqld.cnf`):  
   ```ini
   [mysqld]
   port = 1234
   ```
   Затем перезапустить службу MySQL:  
   ```bash
   sudo systemctl restart mysql
   ```

4. **Какие преимущества даёт виртуализация?**  
   - Эффективное использование ресурсов сервера.  
   - Возможность запуска нескольких систем на одной физической машине.  
   - Лёгкое клонирование, резервное копирование и миграция систем.  
   - Повышенная безопасность через изоляцию систем.  

5. **Для чего необходимо устанавливать время / временную зону на сервере?**  
   - Для корректной работы журналов логов и систем мониторинга.  
   - Для синхронизации времени между клиентами и сервером.  
   - Для правильной работы задач по расписанию (cron).  

6. **Сколько места занимает установленная ОС (виртуальный диск) на хостовой машине?**  
   В моём случае размер установленной ОС 2,1 ГБ

   ![image](https://i.imgur.com/eJNFZMQ.png)

7. **Какие есть рекомендации по разбиению диска для серверов? Почему рекомендуется так разбивать диск?**  
   Рекомендуемая структура разделов:
   - `/` (root) — основной системный раздел (20–30 ГБ).  
   - `/home` — для пользовательских данных.  
   - `/var` — для логов, баз данных и кеша (30–50 ГБ).  
   - `/tmp` — временные файлы.  
   - `swap` — раздел подкачки (зависит от объёма RAM).  

   **Почему так разбивают диск:**  
   - Для повышения стабильности: если один раздел заполнится, это не нарушит работу всей системы.  
   - Для удобства резервного копирования.  
   - Для безопасности: можно ограничить права на разные разделы.

## Вывод

В рамках лабораторной работы я познакомился с принципами виртуализации, освоил процесс установки операционной системы и настройки веб-сервера с базой данных. 
Также была проведена установка и начальная конфигурация CMS Drupal и PhpMyAdmin, а кроме того — настройка виртуальных хостов в Apache. Отдельное внимание было уделено работе в среде ОС Debian, 
где удалось на практике изучить её особенности и научиться оперативно устранять возникающие сложности.

## Библиография

1. Официальный сайт MYSYS2 [https://www.msys2.org/](https://www.msys2.org/)
2. Официальный сайт Debian [https://www.debian.org](https://www.debian.org)
3. Официальная документация QEMU [https://www.qemu.org/documentation](https://www.qemu.org/documentation)